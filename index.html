<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="viewport"
        content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1 user-scalable=0" />
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>矮人礦坑</title>
    <link rel="shortcut icon" href="svg/icon.svg" type="image/x-icon" />
    <meta name="Saboteur" content="矮人礦坑">
    <!-- 常用於 facebook 的 屬性值 -->
    <meta property="og:title" content="矮人礦坑" />
    <meta property="og:type" content="website" />
    <meta property="fb:app_id" content="1040480270093217" />
    <!-- <meta property="og:image:type" content="image/png" /> -->
    <meta property="og:url" content="網址" />
    <meta property="og:image" content="https://i.ibb.co/2kHnBkp/11-2x.png" />
    <meta property="og:description" content="最有質感的線上版矮人礦坑遊戲，一起來玩吧！" />

    <!-- 字體 -->
    <link href="https://fonts.googleapis.com/css2?family=Kosugi+Maru&amp;display=swap" rel="stylesheet">

</head>
<link rel="stylesheet" href="index.css">

<body>
    <!-- Boostrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" rel="stylesheet" //
        integrity="sha384-wEmeIV1mKuiNpC+IOBjI7aAzPcEZeedi5yW5f2yOq55WWLwNGmvvx4Um1vskeMj0" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-p34f1UUtsS3wqzfto5wAAmdvj+osOnFyQFpp4Ua3gs/ZVWx6oOypYoCJhGGScy+8" crossorigin="anonymous">
    </script>
    <!-- HTML -->
    <div class="container">
        <img src="svg/logo.svg" alt="logo pic" class="logo">
        <img src="svg/playernum/playernum3.svg" alt="" class="playernumpic">
        <div class="flexbox">
            <div>玩家人數上限：</div>
            <div class="count">
                <div class="minus">-</div>
                <div id="max-players-number" class="num">3</div>
                <div class="add">+</div>
            </div>
        </div>
        <div class="text"></div>

        <input id="nickname" placeholder="請輸入名字" autocomplete="off" maxlength="10" size="10" type="text" />
        <div class="start">開新房間</div>

    </div>

    <div class="footer">
        <div class="rank">總排行榜</div>
        <!-- 留言板 -->
        <!-- Button trigger modal -->
        <button type="button" class="openbtn" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
            留言板
        </button>

        <!-- Modal -->
        <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
            aria-labelledby="staticBackdropLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header" id="messageTop">
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        <h5 class="modal-title" id="staticBackdropLabel">矮人礦坑-留言板</h5>
                        <div class="mscontainer">
                            <div class="flexbox">
                                <input class="nickName" type="text" placeholder="暱稱">
                                <!-- <select class="category">
                                    <option class="option" value="fun">純屬好玩</option>
                                    <option class="option" value="suggestion">網站建議</option>
                                </select> -->
                            </div>
                            <textarea class="content" type="text" placeholder="請輸入留言..."></textarea>
                            <div class="txt"></div>
                            <div class="savebtn">送出</div>

                        </div>
                    </div>

                    <div class="modal-body" id="messangeArea">
                        <div class="mscontainer">
                            <div class="filter">
                                <!-- <input class="filterbtn" type="button" value="全部" onclick="bbsTypeFilter('all')">
                                <input class="filterbtn" type="button" value="純屬好玩" onclick="bbsTypeFilter('fun')">
                                <input class="filterbtn" type="button" value="網站建議"
                                    onclick="bbsTypeFilter('suggestion')"> -->
                            </div>
                            <ul id="messageBody" class="list"></ul>
                        </div>
                    </div>

                </div>

            </div>
        </div>

        <hr>
        <!-- Button trigger modal 遊戲規則按鈕-->
        <button type="button" class="rulepupup" data-bs-toggle="modal" data-bs-target="#exampleModal">
            遊戲規則
        </button>

        <!-- Modal -->
        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        <h5 class="modal-title" id="exampleModalLabel">怎麼玩？</h5>
                    </div>
                    <div class="modal-body">
                        <!-- <ul>
                            <li>玩家會被分為好矮人、壞矮人</li>
                            <li>好矮人目標是將道路接到有金礦的卡牌上，壞矮人則是阻止好矮人達到目的。</li>
                            <li>玩家每次必須出一張手牌，可用來連接道路、陷害或幫助別人、也可以棄牌，再補一張手牌。</li>
                        </ul>
                        <hr> -->

                            <!-- 介紹遊戲怎麼玩 -->
                            <div id="carouselExampleInterval" class="carousel slide" data-bs-ride="carousel">
                                <div class="carousel-inner">
                                    <div class="carousel-item active" data-bs-interval="10000">
                                        <b>1.放置道路卡</b>
                                        <p>從手牌區選取道路卡放置於牌面上</p>
                                        <img src="gif/putroad.gif" class="d-block w-100" alt="...">
                                    </div>
                                    <div class="carousel-item" data-bs-interval="2000">
                                        <b>2.棄牌並跳過</b>
                                        <p>選取一張卡牌棄牌，並跳過這一回合</p>
                                        <img src="gif/trash.gif" class="d-block w-100" alt="...">
                                    </div>
                                    <div class="carousel-item">
                                        <b>3.使用地圖卡</b>
                                        <p>使用地圖卡可以任選一張終點卡查看是否有金礦</p>
                                        <img src="gif/map_gold.gif" class="d-block w-100" alt="...">
                                    </div>
                                    <div class="carousel-item">
                                        <b>4.使用崩路卡</b>
                                        <p>使用崩路卡可以任選一格牌面上的道路進行移除</p>
                                        <img src="gif/removeRoad.gif" class="d-block w-100" alt="...">
                                    </div>
                                    <div class="carousel-item">
                                        <b>5.使用破壞工具卡(封鎖其他玩家)</b>
                                        <p>使用破壞卡破壞其他玩家的工具，被封鎖的玩家不能出道路卡</p>
                                        <img src="gif/ban.gif" class="d-block w-100" alt="...">
                                    </div>
                                    <div class="carousel-item">
                                        <b>5.使用修理工具卡(解救其他玩家)</b>
                                        <p>使用修理卡解救被封鎖的玩家或自己</p>
                                        <img src="gif/save.gif" class="d-block w-100" alt="...">
                                    </div>
                                    <div class="carousel-item">
                                        <b>6.獲勝條件</b>
                                        <p>最後將道路連接到有金礦的卡牌即獲勝</p>
                                        <img src="gif/win.gif" class="d-block w-100" alt="...">
                                    </div>
                                </div>
                                <button class="carousel-control-prev" type="button"
                                    data-bs-target="#carouselExampleInterval" data-bs-slide="prev">
                                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                    <span class="visually-hidden">Previous</span>
                                </button>
                                <button class="carousel-control-next" type="button"
                                    data-bs-target="#carouselExampleInterval" data-bs-slide="next">
                                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                    <span class="visually-hidden">Next</span>
                                </button>
                            </div>
                            
                            <hr>
                            <div id="carouselExampleIndicators" class="carousel slide" data-bs-ride="carousel">
                                <div class="carousel-indicators">
                                    <button type="button" data-bs-target="#carouselExampleIndicators"
                                        data-bs-slide-to="0" class="active" aria-current="true"
                                        aria-label="Slide 1"></button>
                                    <button type="button" data-bs-target="#carouselExampleIndicators"
                                        data-bs-slide-to="1" aria-label="Slide 2"></button>
                                    <button type="button" data-bs-target="#carouselExampleIndicators"
                                        data-bs-slide-to="2" aria-label="Slide 3"></button>
                                    <button type="button" data-bs-target="#carouselExampleIndicators"
                                        data-bs-slide-to="3" aria-label="Slide 4"></button>
                                    <button type="button" data-bs-target="#carouselExampleIndicators"
                                    data-bs-slide-to="4" aria-label="Slide 5"></button>
                                    <button type="button" data-bs-target="#carouselExampleIndicators"
                                    data-bs-slide-to="5" aria-label="Slide 6"></button>
                                    <button type="button" data-bs-target="#carouselExampleIndicators"
                                    data-bs-slide-to="6" aria-label="Slide 7"></button>
                                    <button type="button" data-bs-target="#carouselExampleIndicators"
                                    data-bs-slide-to="7" aria-label="Slide 8"></button>
                                </div>
                                <div class="carousel-inner">
                                    <div class="carousel-item active">
                                        <b>功能卡4-1:崩路卡</b>
                                        <p>用來移除牌面上的道路或坑洞</p>
                                        <img src="svg/cards/card66.svg" class="d-block w-100">
                                    </div>
                                    <div class="carousel-item">
                                        <b>功能卡4-2:地圖卡</b>
                                        <p>用來偷看一張終點卡看是否有金礦</p>
                                        <img src="svg/cards/card46.svg" class="d-block w-100">
                                    </div>
                                    <div class="carousel-item">
                                        <b>功能卡4-3:封鎖卡</b>
                                        <p>用來破壞其他玩家的道具，被封鎖者不能出道路卡</p>
                                        <img src="svg/cards/card56.svg" class="d-block w-100">
                                    </div>
                                    <div class="carousel-item">
                                        <b>功能卡4-4:解救卡</b>
                                        <p>用來修理被破壞的道具，恢復出卡功能</p>
                                        <img src="svg/cards/card47.svg" class="d-block w-100">
                                    </div>
                                    <div class="carousel-item">
                                        <b>一般道路卡</b>
                                        <p>用來連接道路以到達金礦</p>
                                        <img src="svg/cards/card1.svg" class="d-block w-100">
                                    </div>
                                    <div class="carousel-item">
                                        <b>坑路卡</b>
                                        <p>放置坑路阻擋道路繼續聯通</p>
                                        <img src="svg/cards/card36.svg" class="d-block w-100">
                                    </div>
                                </div>
                                <button class="carousel-control-prev" type="button"
                                    data-bs-target="#carouselExampleIndicators" data-bs-slide="prev">
                                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                    <span class="visually-hidden">Previous</span>
                                </button>
                                <button class="carousel-control-next" type="button"
                                    data-bs-target="#carouselExampleIndicators" data-bs-slide="next">
                                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                    <span class="visually-hidden">Next</span>
                                </button>
                            </div>
                            <!--   hr    -->
                            <div class="accordion accordion-flush" id="accordionFlushExample">
                                <div class="title">遊戲流程</div>
                                <p>每個人的回合都可以選擇下列三個行動<b>其中一種</b>執行。</p>
                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="flush-headingOne">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                            data-bs-target="#flush-collapseOne" aria-expanded="false"
                                            aria-controls="flush-collapseOne">
                                            #1 出『道路卡』
                                        </button>
                                    </h2>
                                    <div id="flush-collapseOne" class="accordion-collapse collapse"
                                        aria-labelledby="flush-headingOne" data-bs-parent="#accordionFlushExample">
                                        <div class="accordion-body">
                                            <ul>
                                                <li>道路卡需要從<b>起點卡</b>開始，向外延伸出去。</li>
                                                <li>道路卡必須與已經放置的道路卡上的路相連通(斜角碰觸不算)。</li>
                                                <li>道路卡必須與起點卡<b>方向一致</b>的排列。不能有的橫的有的直的。</ol>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="flush-headingTwo">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                            data-bs-target="#flush-collapseTwo" aria-expanded="false"
                                            aria-controls="flush-collapseTwo">
                                            #2 出『行動卡』
                                        </button>
                                    </h2>
                                    <div id="flush-collapseTwo" class="accordion-collapse collapse"
                                        aria-labelledby="flush-headingTwo" data-bs-parent="#accordionFlushExample">
                                        <div class="accordion-body">
                                            <ul>
                                                <li>行動卡包含：<code>破壞卡</code>、<code>修理卡</code>、<code>崩路卡</code>及<code>地圖卡</code>。
                                                </li>
                                                <li><code>破壞卡</code>：破壞其他玩家的工具(油燈/礦車/斧頭)，可使其他玩家不能出『道路卡』。</li>
                                                <li><code>修理卡</code>：可以把被破壞的工具修理好。</li>
                                                <li><code>崩路卡</code>：可將原本蓋好的道路摧毀（起點和終點卡除外）。
                                                <li class="none">壞矮人可以用它來破壞道路，好矮人可以用它來清除死路。</li>
                                                </li>
                                                <li><code>地圖卡</code>：可選擇看一張終點卡是金礦還是石頭，只有自己知道。</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="flush-headingThree">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                            data-bs-target="#flush-collapseThree" aria-expanded="false"
                                            aria-controls="flush-collapseThree">
                                            #3 『棄掉一張卡』
                                        </button>
                                    </h2>
                                    <div id="flush-collapseThree" class="accordion-collapse collapse"
                                        aria-labelledby="flush-headingThree" data-bs-parent="#accordionFlushExample">
                                        <div class="accordion-body">
                                            <ul>
                                                <li>如果玩家不想出牌或不能出牌，可以將卡牌丟到棄牌堆中。</li>
                                                <li>棄牌後，如果牌庫還有卡牌，會自動再補一張手牌，並輪到下一位玩家行動。</li>
                                                </li>
                                            </ul>
    
                                        </div>
                                    </div>
                                </div>
                                <div class="accordion-item">
                                    <h2 class="accordion-header" id="flush-headingFour">
                                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                            data-bs-target="#flush-collapseFour" aria-expanded="false"
                                            aria-controls="flush-collapseFour">
                                            遊戲結束 Ending the Game
                                        </button>
                                    </h2>
                                    <div id="flush-collapseFour" class="accordion-collapse collapse"
                                        aria-labelledby="flush-headingFour" data-bs-parent="#accordionFlushExample">
                                        <div class="accordion-body">
                                            <ul>
                                                <li>當玩家能將一張道路卡連接到<b>終點卡</b>，並製造一條與起點卡間無阻礙的通道時，可以將連結的終點卡掀開。</li>
                                                <li>若翻出的終點卡上出現的是石塊，繼續進行遊戲。</li>
                                                <li>若翻出的終點卡上出現的是金塊，則好矮人獲勝。</li>
                                                <li>若所有玩家手牌用盡或是無牌可出，則壞矮人獲勝。</li>
                                            </ul>
    
                                        </div>
                                    </div>
                                </div>
                            <!--  -->

                        </div>
                    </div>
                </div>
            </div>
        </div>
</body>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"
    integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous">
</script>
<script src="./script/api.js"></script>
<script src="https://kit.fontawesome.com/5223ebc999.js" crossorigin="anonymous"></script>

<script>
    $('.rank').click(function () {
        window.location.href = "./rank.html";
    })
    //nickName
    $(document).ready(function () {
        const nickname = getNickName();
        $('#nickname').val(nickname);
    });

    $('.start').click(function () {
        const nickname = $('#nickname').val();
        if (nickname.trim() === '') {
            alert('請輸入暱稱');
            return;
        }
        saveNickName(nickname);
        callApi('/rooms', 'POST', {
            name: nickname,
            maxPlayersNumber: $('#max-players-number').text()
        }).then((response) => {
            const roomId = response.data.room_id;

            window.location.href = `./waiting.html?room_id=${roomId}`;
        });

    });
    const getNickName = () => {
        const nickname = window.localStorage.getItem('nickname');
        return nickname ? nickname : '';
    }

    const saveNickName = (nickname) => {
        window.localStorage.setItem("nickname", nickname)
    }

    // 回合增減數量
    var num = 3;

    function click(num_var) {
        if (num + num_var < 3 || num + num_var > 10) {
            return
        };
        num = num + num_var;
        $(".num").text(num);
    }
    $(".minus").click(
        function () {
            click(-1);
            check();
        }
    )
    $(".add").click(
        function () {
            click(1);
            check();
        }
    )

    //震動
    $(".minus").click(function () {
        if (num == 3 || num == 10) {
            wiggletime = 0;
        }
        console.log(wiggletime)
    });
    var wiggletime = 21;
    setInterval(function () {
        if (wiggletime <= 20) {
            wiggletime += 1;
            if (wiggletime % 2 == 0) {
                $(".count").css("left", "-10px");
            } else {
                $(".count").css("left", "10px");
            }

            if (wiggletime == 21) {
                $(".count").css("left", "");
            }

        }
    }, 60);

    //依回合數量顯示不同警示訊息
    function check() {
        if (num < 4) {
            $(".playernumpic").attr("src", "svg/playernum/playernum3.svg");
            $(".text").text("這遊戲至少要三個人玩喔！再交點朋友吧^^");
            $(".text").css("color", "orange");
            return;
        }

        if (num == 4) {
            $(".playernumpic").attr("src", "svg/playernum/playernum4.svg");
            return;
        }
        if (num == 5) {
            $(".playernumpic").attr("src", "svg/playernum/playernum5.svg");
            return;
        }
        if (num == 6) {
            $(".playernumpic").attr("src", "svg/playernum/playernum6.svg");
            return;
        }

        if (num == 7) {
            $(".playernumpic").attr("src", "svg/playernum/playernum7.svg");
            return;
        }
        if (num == 8) {
            $(".playernumpic").attr("src", "svg/playernum/playernum8.svg");
            return;
        }
        if (num == 9) {
            $(".playernumpic").attr("src", "svg/playernum/playernum9.svg");
            return;
        }
        if (num > 9) {
            $(".playernumpic").attr("src", "svg/playernum/playernum10.svg");
            $(".text").text("一次最多只能10位玩家喔！");
            $(".text").css("color", "red");
            return;
        }
    }
    // 留言板功能
    document.querySelector(".savebtn").addEventListener("click", function (e) {
        messageBody.scrollTop = messageBody.scrollHeight - messageBody.clientHeight;

        // 新增邏輯
        const nickName = $(".nickName").val();
        const content = $(".content").val();
        const category = $(".category").val();

        if (nickName === '' || content === '') {
            alert('暱稱及留言內容都要輸入哦！');
            return;
        }
        messageBody.scrollTop = messageBody.scrollHeight - messageBody.clientHeight;
        $(".txt").text("已成功送出留言！");
        $(".txt").css("color", "orange");

        callApi('/bbs', 'POST', {
            nickname: nickName,
            type: 'fun',
            content: content
        })

        callApi('/bbs').then((response) => {
            let renderString = "";

            response.data.forEach(data => {
                console.log(data)
                renderString += `<li><b>${data.nickname}</b>：${data.content}</li>`;
            });

            $('.list').html(renderString);
        })
    })

    document.querySelector(".openbtn").addEventListener('click', (e) => {
        callApi('/bbs').then((response) => {
            let renderString = "";

            response.data.forEach(data => {
                console.log(data)
                renderString +=
                    `<li><div class="bbsname">${data.nickname}：</div><div style="display:block; text-align:left; padding-left:43px; font-size:12px;">${data.content}</div><div style="display:block;text-align:right">${data.created_date}</div></li>`;
            });

            $('.list').html(renderString);
        })
    });

    const bbsTypeFilter = (type) => {
        callApi(`/bbs?type=${type}`).then((response) => {
            let renderString = "";

            response.data.forEach(data => {
                renderString += `<li><b>${data.nickname}</b>：${data.content}</li>`;
            });

            $('.list').html(renderString);
        })
    }
</script>

</html>