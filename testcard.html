<!DOCTYPE html PUBLIC "-//WAPFORUM//DTD XHTML Mobile 1.0//EN" "http://www.wapforum.org/DTD/xhtml-mobile10.dtd">
<html lang="en">

<head>
  <meta name="viewport"
    content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=0.25 user-scalable=0" />
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>矮人礦坑</title>
  <!-- <link rel="shortcut icon" href="https://i.ibb.co/vJ42VtN/ia2b-001.png" type="image/x-icon" /> -->
  <meta name="1A2B" content="矮人礦坑" />
  <meta property="og:title" content="矮人礦坑" />
  <!-- <meta property="og:image" content="https://i.ibb.co/3RxtDV9/001.png" /> -->
  <meta property="og:description" content="矮人礦坑！" />
  <script src="https://kit.fontawesome.com/5223ebc999.js" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"
    integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
</head>
<link rel="stylesheet" href="playpage.css" />

<body>
  <div class="container">
    <div class="cuetext topcue">
      測試卡片
    </div>
    <!-- 棋盤格子區 -->
    <div class="flexbox showarea">
      <div class="line line1">
        <div id="block1-1" class="block block1-1"></div>
        <div id="block1-2" class="block block1-2"></div>
        <div id="block1-3 end2" class="block block1-3 end2">
            <svg class="card card1" viewbox="-30 -18 60 36" style="background-image: url(svg/card_start.svg);background-size: cover;">
                <line x1="-30" y1="0" x2="30" y2="0"></line>
                <line x1="0" y1="-18" x2="0" y2="18"></line>
            </svg>
        </div>
        <div id="block1-4" class="block block1-4"></div>
        <div id="block1-5" class="block block1-5 end3"></div>
      </div>
      <div class="line line2">
        <div id="block2-1" class="block block2-1"></div>
        <div id="block2-2" class="block block2-2"></div>
        <div id="block2-3" class="block block2-3"></div>
        <div id="block2-4" class="block block2-4"></div>
        <div id="block2-5" class="block block2-5"></div>
      </div>
      <div class="line line3">
        <div id="block3-1" class="block block3-1"></div>
        <div id="block3-2" class="block block3-1"></div>
        <div id="block3-3" class="block block3-1"></div>
        <div id="block3-4" class="block block3-1"></div>
        <div id="block3-5" class="block block3-1"></div>
      </div>
      <div class="line line4">
        <div id="block4-1" class="block block4-1"></div>
        <div id="block4-2" class="block block4-1"></div>
        <div id="block4-3" class="block block4-1"></div>
        <div id="block4-4" class="block block4-1"></div>
        <div id="block4-5" class="block block4-1"></div>
      </div>
      <div class="line line5">
        <div id="block5-1" class="block block5-1"></div>
        <div id="block5-2" class="block block5-1"></div>
        <div id="block5-3" class="block block5-1"></div>
        <div id="block5-4" class="block block5-1"></div>
        <div id="block5-5" class="block block5-1"></div>
      </div>
      <div class="line line6">
        <div id="block6-1" class="block block6-1"></div>
        <div id="block6-2" class="block block6-1"></div>
        <div id="block6-3" class="block block6-1"></div>
        <div id="block6-4" class="block block6-1"></div>
        <div id="block6-5" class="block block6-1"></div>
      </div>
      <div class="line line7">
        <div id="block7-1" class="block block7-1"></div>
        <div id="block7-2" class="block block7-1"></div>
        <div id="block7-3" class="block block7-1"></div>
        <div id="block7-4" class="block block7-1"></div>
        <div id="block7-5" class="block block7-1"></div>
      </div>
      <div class="line line8">
        <div id="block8-1" class="block block8-1"></div>
        <div id="block8-2" class="block block8-1"></div>
        <div id="block8-3" class="block block8-1"></div>
        <div id="block8-4" class="block block8-1"></div>
        <div id="block8-5" class="block block8-1"></div>
      </div>
      <div class="line line9">
        <div id="block9-1 end1" class="block block9-1 end1">
          <img data-num="0" src="svg/cards_blank.svg" alt="" id="end1" />
        </div>
        <div id="block9-2" class="block block9-2"></div>
        <div id="block9-3 end2" class="block block9-3 end2">
          <img data-num="1" src="svg/cards_blank.svg" alt="" id="end2" />
        </div>
        <div id="block9-4" class="block block9-4"></div>
        <div id="block9-5  end3" class="block block9-5 end3">
          <img data-num="2" src="svg/cards_blank.svg" alt="" id="end3" />
        </div>
      </div>
    </div>

    <!-- 手牌區 -->
    <div class="flexbox handcardarea">
      <div class="handcardbox1" data-num="1">
        <svg class="card card6" viewbox="-30 -18 60 36" style="background-image: url(svg/cards/card6.svg);background-size: cover;">
            <line x1="-30" y1="0" x2="30" y2="0"></line>
            <line x1="0" y1="0" x2="0" y2="18"></line>
        </svg>
        <i data-num="1" class="fas fa-undo-alt cycle-1"></i>
      </div>

      <div class="handcardbox2" data-num="2">
        <img id="handCard2" class="card cardnum2" data-num="2" src="svg/cards_blank.svg" />
        <i data-num="2" class="fas fa-undo-alt cycle-2"></i>
      </div>

      <div class="handcardbox3" data-num="3">
        <img id="handCard3" class="card cardnum3" data-num="3" src="svg/cards_blank.svg" />
        <i data-num="3" class="fas fa-undo-alt cycle-3"></i>
      </div>

      <div class="handcardbox4" data-num="4">
        <img id="handCard4" class="card cardnum4" data-num="4" src="svg/cards_blank.svg" />
        <i data-num="4" class="fas fa-undo-alt cycle-4"></i>
      </div>

      <div class="handcardbox5" data-num="5">
        <img id="handCard5" class="card cardnum5" data-num="5" src="svg/cards_blank.svg" />
        <i data-num="5" class="fas fa-undo-alt cycle-5"></i>
      </div>

      <div class="handcardbox6" data-num="6">
        <img id="handCard6" class="card cardnum6" data-num="6" src="svg/cards_blank.svg" />
        <i data-num="6" class="fas fa-undo-alt cycle-6"></i>
      </div>
    </div>

</body>

<script>
  const hasRedBorder = () => {
    return $('.redborder').length ? true : false;
  }



  $(".container").click(function (e) {
    console.log(e)
    console.log($('.redborder').attr('class'));
  })

  //遊戲開始時，隨機產生六張手牌給玩家
  var pools = [];

  let poolsGenerator = function (arr) {
    if (arr.length >= 67) return;
    let newNumber = Math.floor(Math.random() * 67 + 1);
    if (arr.indexOf(newNumber) < 0) {
      arr.push(newNumber);
    }
    poolsGenerator(arr);
  };
  poolsGenerator(pools);

  let handCards = [];
  handCards = pools.splice(0, 6)

  function Cardput() {
    //如果點選牌面上已放好的卡（沒有id），且圈選到的是“崩路卡”，警示，『刪掉一張卡』，初新手牌
    if (event.target.id == "" && $('.redborder').attr("src").search(/65|66|67/) == 14) {
      alert("確定要崩掉這張卡ㄇ！？");
      giveNewCard();
      $(".topcue").text("你剛剛炸掉了一張卡牌～")
      return;

    }
    //圈選手牌後，可再點擊的位置：block|end|trash，其他處不可放卡牌，如：起始牌、已放卡牌的位置
    if (event.target.id.search(/block|end|trash/) == -1) {
      alert("此處不能放置卡牌");
      return;
    }
    //如果圈選的手牌是“地圖卡”，不可放在牌區，只可以丟棄，或去點終點卡
    if ($('.redborder').attr("src").search(/41|42|43|44|45|46/) == 14) {
      alert("不能把地圖卡放在這邊喔！");
      return;
    }
    //如果圈選的手牌是“破壞卡”，不可放在牌區
    if ($('.redborder').attr("src").search(/56|57|58|59|60|61|62|63|64/) == 14) {
      alert("不能把破壞卡放在這邊喔！");
      return;
    }
    //如果圈選的手牌是“崩路卡”，不可放在牌區，只可以丟棄，或去點已放的卡牌炸掉
    if ($('.redborder').attr("src").search(/65|66|67/) == 14) {
      alert("不能把崩路卡放在這邊喔！");
      return;
    }
    //如果圈選的手牌是“道路卡”，可以放在牌區，並且會印出出牌的卡，並在補上手牌
    if (event.target.id.search("block") == 0) {
      printNewCard()
      giveNewCard();
    }
  }

  function printNewCard() {
    const element = document.getElementById(event.target.id);
    const boxnum = $(".redborder").attr("data-num")
    const svg = $(".handcardbox" + boxnum + " img").attr('src');
    const style = $(".handcardbox" + boxnum + " img").css('transform');
    element.innerHTML += `<img src='${svg}' style='transform:${style}'>`;
  }

  function giveNewCard() {
    const boxnum = $(".redborder").attr("data-num")
    const index = boxnum - 1
    handCards.splice(index, 1, pools.pop());
    $(`#handCard${boxnum}`).attr("src", `svg/cards/card${handCards[index]}.svg`)
    $(".redborder").removeClass("redborder");
  }

  $(document).ready(function () {
    $("#handCard1").attr("src", `svg/cards/card${handCards[0]}.svg`);
    $("#handCard2").attr("src", `svg/cards/card${handCards[1]}.svg`);
    $("#handCard3").attr("src", `svg/cards/card${handCards[2]}.svg`);
    $("#handCard4").attr("src", `svg/cards/card${handCards[3]}.svg`);
    $("#handCard5").attr("src", `svg/cards/card${handCards[4]}.svg`);
    $("#handCard6").attr("src", `svg/cards/card${handCards[5]}.svg`);
  });

  $(".block").click(function (e) {
    if (!hasRedBorder()) {
      return;
    }
    if (hasRedBorder()) {
      Cardput();
    }
  })

  // 圖卡旋轉
  var degrees = 0;

  function rotatecard(object) {
    degrees += 180;
    console.log(degrees)
    object.css({
      'transform': 'rotate(' + degrees + 'deg)',
      '-ms-transform': 'rotate(' + degrees + 'deg)',
      '-moz-transform': 'rotate(' + degrees + 'deg)',
      '-webkit-transform': 'rotate(' + degrees + 'deg)',
      '-o-transform': 'rotate(' + degrees + 'deg)'
    });
  }

  var degrees = 0;
  $(".fa-undo-alt").on("click", function (e) {
    const number = $(this).attr("data-num")
    rotatecard($(".cardnum" + number));
  });


  //功能:點擊卡牌產生紅色提醒
  $(".card").click(function (e) {
    // console.log($(this).attr('class').search("redborder")); 找不到會回傳-1
    if ($(this).attr('class').search("redborder") == -1) {
      $(".redborder").removeClass("redborder");
      $(this).addClass("redborder");

    }
  });





</script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/css/bootstrap.min.css" rel="stylesheet" //
  integrity="sha384-wEmeIV1mKuiNpC+IOBjI7aAzPcEZeedi5yW5f2yOq55WWLwNGmvvx4Um1vskeMj0" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-p34f1UUtsS3wqzfto5wAAmdvj+osOnFyQFpp4Ua3gs/ZVWx6oOypYoCJhGGScy+8" crossorigin="anonymous">
</script>

</html>